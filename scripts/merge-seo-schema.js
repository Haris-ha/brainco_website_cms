/**
 * åˆå¹¶ SEO æ•°æ®å’Œ Schema æ•°æ®è„šæœ¬
 * å°† seo-data.json å’Œ schema-data-config.json åˆå¹¶ä¸ºä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶
 * åŒæ—¶è‡ªåŠ¨è¡¥å……ç¼ºå¤±çš„ç¹ä½“ä¸­æ–‡æ•°æ®
 */

const fs = require('fs');
const path = require('path');

// ç®€ä½“è½¬ç¹ä½“çš„ç®€å•æ˜ å°„ï¼ˆå¸¸ç”¨å­—ï¼‰
const s2tMap = {
  'å¼ºè„‘ç§‘æŠ€': 'å¼·è…¦ç§‘æŠ€',
  'è„‘æœºæ¥å£': 'è…¦æ©Ÿæ¥å£',
  'æŠ€æœ¯': 'æŠ€è¡“',
  'å…¬å¸': 'å…¬å¸',
  'å…¨çƒé¢†å…ˆ': 'å…¨çƒé ˜å…ˆ',
  'æ™ºèƒ½ä»¿ç”Ÿæ‰‹': 'æ™ºèƒ½ä»¿ç”Ÿæ‰‹',
  'è„‘æ§è½®æ¤…': 'è…¦æ§è¼ªæ¤…',
  'ä¸“æ³¨åŠ›è®­ç»ƒ': 'å°ˆæ³¨åŠ›è¨“ç·´',
  'é¢†å¯¼è€…': 'é ˜å°è€…',
  'ä¸“åˆ©': 'å°ˆåˆ©',
  'æä¾›': 'æä¾›',
  'åº·å¤æœºå™¨äºº': 'åº·å¾©æ©Ÿå™¨äºº',
  'åˆ›æ–°äº§å“': 'å‰µæ–°ç”¢å“',
  'æœåŠ¡': 'æœå‹™',
  'æ•™è‚²': 'æ•™è‚²',
  'åŒ»ç–—': 'é†«ç™‚',
  'åº·å¤': 'åº·å¾©',
  'å¥åº·ç®¡ç†': 'å¥åº·ç®¡ç†',
  'é¢†åŸŸ': 'é ˜åŸŸ',
  'æ”¹å˜ä¸–ç•Œ': 'æ”¹è®Šä¸–ç•Œ',
  'åˆ›æ–°å®éªŒå®¤': 'å‰µæ–°å¯¦é©—å®¤',
  'å­µåŒ–': 'å­µåŒ–',
  'å›½å®¶': 'åœ‹å®¶',
  'è§£å†³æ–¹æ¡ˆ': 'è§£æ±ºæ–¹æ¡ˆ',
  'å…³äºæˆ‘ä»¬': 'é—œæ–¼æˆ‘å€‘',
  'éä¾µå…¥å¼': 'éä¾µå…¥å¼',
  'è‡´åŠ›äº': 'è‡´åŠ›æ–¼',
  'èµ‹èƒ½': 'è³¦èƒ½',
  'äººæœºäº¤äº’': 'äººæ©Ÿäº¤äº’',
  'äº†è§£': 'äº†è§£',
  'æ„¿æ™¯': 'é¡˜æ™¯',
  'å›¢é˜Ÿ': 'åœ˜éšŠ',
  'å‘å±•å†ç¨‹': 'ç™¼å±•æ­·ç¨‹',
  'æ¢ç´¢': 'æ¢ç´¢',
  'å¦‚ä½•': 'å¦‚ä½•',
  'é€šè¿‡': 'é€šé',
  'é©å‘½æ€§': 'é©å‘½æ€§',
  'å˜é©': 'è®Šé©',
  'ä»‹ç»': 'ä»‹ç´¹',
  'è¡Œä¸š': 'è¡Œæ¥­',
  'æˆç«‹äº': 'æˆç«‹æ–¼',
  'å¤§å­¦': 'å¤§å­¸',
  'æ‹¥æœ‰': 'æ“æœ‰',
  'æ ¸å¿ƒ': 'æ ¸å¿ƒ',
  'é‡Œç¨‹ç¢‘': 'é‡Œç¨‹ç¢‘',
  'è£èª‰': 'æ¦®è­½',
  'èµ„è´¨': 'è³‡è³ª',
  'å¸ƒå±€': 'ä½ˆå±€',
  'è§è¯': 'è¦‹è­‰',
  'ä¹‹è·¯': 'ä¹‹è·¯',
  'æºè‡ª': 'æºè‡ª',
  'ä¼ä¸š': 'ä¼æ¥­',
  'ä»': 'å¾',
  'èµ°å‡º': 'èµ°å‡º',
  'åœ°åŒº': 'åœ°å€',
  'è”ç³»': 'è¯ç¹«',
  'å’¨è¯¢': 'è«®è©¢',
  'åˆä½œ': 'åˆä½œ',
  'è”ç»œ': 'è¯çµ¡',
  'åŠå…¬å®¤': 'è¾¦å…¬å®¤',
  'éšæ—¶': 'éš¨æ™‚',
  'ä¸“ä¸š': 'å°ˆæ¥­',
  'æ”¯æŒ': 'æ”¯æŒ',
  'å¼€å¯': 'é–‹å•Ÿ',
  'æ— è®º': 'ç„¡è«–',
  'æ´½è°ˆ': 'æ´½è«‡',
  'è¿˜æ˜¯': 'é‚„æ˜¯',
  'ç§‘å­¦å®¶': 'ç§‘å­¸å®¶',
  'ä½™é¡¹': 'é¤˜é …',
  'å‘æ˜': 'ç™¼æ˜',
  'æ·±å…¥': 'æ·±å…¥',
  'è„‘ç”µä¿¡å·': 'è…¦é›»ä¿¡è™Ÿ',
  'é‡‡é›†': 'æ¡é›†',
  'ç¥ç»': 'ç¥ç¶“',
  'åé¦ˆ': 'åé¥‹',
  'ç®—æ³•': 'ç®—æ³•',
  'å‰æ²¿': 'å‰æ²¿',
  'é©±åŠ¨': 'é©…å‹•',
  'çªç ´': 'çªç ´',
  'å¼•é¢†': 'å¼•é ˜',
  'é‡‡ç”¨': 'æ¡ç”¨',
  'å…ˆè¿›': 'å…ˆé€²',
  'è‚Œç”µ': 'è‚Œé›»',
  'è¯†åˆ«': 'è­˜åˆ¥',
  'è®©': 'è®“',
  'ä¸Šè‚¢': 'ä¸Šè‚¢',
  'æˆªè‚¢è€…': 'æˆªè‚¢è€…',
  'é‡è·': 'é‡ç²',
  'çµå·§': 'éˆå·§',
  'åŒæ‰‹': 'é›™æ‰‹',
  'è®¤è¯': 'èªè­‰',
  'è¶…è¿‡': 'è¶…é',
  'åŠ¨ä½œ': 'å‹•ä½œ',
  'å‡†ç¡®ç‡': 'æº–ç¢ºç‡',
  'æ®‹éšœ': 'æ®˜éšœ',
  'äººå£«': 'äººå£«',
  'ç”Ÿæ´»': 'ç”Ÿæ´»',
  'ç”¨': 'ç”¨',
  'é‡å¡‘': 'é‡å¡‘',
  'åŠ›é‡': 'åŠ›é‡',
  'è¯†åˆ«å‡†ç¡®ç‡': 'è­˜åˆ¥æº–ç¢ºç‡',
  'æŒæ§': 'æŒæ§',
  'å…¨çƒé¦–æ¬¾': 'å…¨çƒé¦–æ¬¾',
  'æ¶ˆè´¹çº§': 'æ¶ˆè²»ç´š',
  'ä¸¥é‡': 'åš´é‡',
  'è¿åŠ¨': 'é‹å‹•',
  'éšœç¢': 'éšœç¤™',
  'æ‚£è€…': 'æ‚£è€…',
  'è„‘ç”µæ³¢': 'è…¦é›»æ³¢',
  'æ§åˆ¶': 'æ§åˆ¶',
  'è½®æ¤…': 'è¼ªæ¤…',
  'ç§»åŠ¨': 'ç§»å‹•',
  'è§£æ”¾': 'è§£æ”¾',
  'è¡ŒåŠ¨': 'è¡Œå‹•',
  'è‡ªç”±': 'è‡ªç”±',
  'æ„å¿µ': 'æ„å¿µ',
  'é‡åº¦': 'é‡åº¦',
  'å•æ‰‹': 'å–®æ‰‹',
  'ç»“åˆ': 'çµåˆ',
  'ä¸ªæ€§åŒ–': 'å€‹æ€§åŒ–',
  'ä¸­é£': 'ä¸­é¢¨',
  'åç˜«': 'åç™±',
  'åŠ é€Ÿ': 'åŠ é€Ÿ',
  'æ˜¾è‘—': 'é¡¯è‘—',
  'æå‡': 'æå‡',
  'æ•ˆæœ': 'æ•ˆæœ',
  'åŠŸèƒ½': 'åŠŸèƒ½',
  'æ¢å¤': 'æ¢å¾©',
  'åŒæ‰‹': 'é›™æ‰‹',
  'åŒæ­¥': 'åŒæ­¥',
  'åŒä¸Šè‚¢': 'é›™ä¸Šè‚¢',
  'ç³»ç»Ÿ': 'ç³»çµ±',
  'æ™ºèƒ½': 'æ™ºèƒ½',
  'é€‚ç”¨äº': 'é©ç”¨æ–¼',
  'åˆ›ä¼¤': 'å‰µå‚·',
  'å¯¼è‡´': 'å°è‡´',
  'åŒä¾§': 'é›™å´',
  'å…¨é¢': 'å…¨é¢',
  'è¿›ç¨‹': 'é€²ç¨‹',
  'ååŒ': 'å”åŒ',
  'ç¡çœ ': 'ç¡çœ ',
  'å¤´ç¯': 'é ­ç’°',
  'ç»é¢…': 'ç¶“é¡±',
  'å¾®ç”µæµ': 'å¾®é›»æµ',
  'åˆºæ¿€': 'åˆºæ¿€',
  'ç§‘å­¦': 'ç§‘å­¸',
  'å…¥ç¡': 'å…¥ç¡',
  'å›°éš¾': 'å›°é›£',
  'è´¨é‡': 'è³ªé‡',
  'æ— éœ€': 'ç„¡éœ€',
  'è¯ç‰©': 'è—¥ç‰©',
  'å®‰å…¨': 'å®‰å…¨',
  'æœ‰æ•ˆ': 'æœ‰æ•ˆ',
  'æ¯æ™š': 'æ¯æ™š',
  'äº«å—': 'äº«å—',
  'æ·±åº¦': 'æ·±åº¦',
  'åŠ©åŠ›': 'åŠ©åŠ›',
  'å¥½çœ ': 'å¥½çœ ',
  'ä¾èµ–': 'ä¾è³´',
  'å®æ—¶': 'å¯¦æ™‚',
  'ç›‘æµ‹': 'ç›£æ¸¬',
  'å­¦ä¹ ': 'å­¸ç¿’',
  'æ•ˆç‡': 'æ•ˆç‡',
  'å­¦ç”Ÿ': 'å­¸ç”Ÿ',
  'èŒåœº': 'è·å ´',
  'å¸®åŠ©': 'å¹«åŠ©',
  'å·¥ä½œ': 'å·¥ä½œ',
  'ä¿æŒ': 'ä¿æŒ',
  'é«˜åº¦': 'é«˜åº¦',
  'ç”Ÿäº§åŠ›': 'ç”Ÿç”¢åŠ›',
  'é£è·ƒ': 'é£›èº',
  'æ›´é«˜æ•ˆ': 'æ›´é«˜æ•ˆ',
  'æ”¾æ¾': 'æ”¾é¬†',
  'å†¥æƒ³': 'å†¥æƒ³',
  'è„‘æ³¢': 'è…¦æ³¢',
  'å‹åŠ›': 'å£“åŠ›',
  'å¿ƒæµ': 'å¿ƒæµ',
  'çŠ¶æ€': 'ç‹€æ…‹',
  'ç¼“è§£': 'ç·©è§£',
  'å®ç°': 'å¯¦ç¾',
  'èº«å¿ƒ': 'èº«å¿ƒ',
  'å¹³è¡¡': 'å¹³è¡¡',
  'å®Œç¾': 'å®Œç¾',
  'è®°å¿†åŠ›': 'è¨˜æ†¶åŠ›',
  'æ³¨æ„åŠ›': 'æ³¨æ„åŠ›',
  'ååº”': 'åæ‡‰',
  'é€Ÿåº¦': 'é€Ÿåº¦',
  'è®¤çŸ¥': 'èªçŸ¥',
  'èƒ½åŠ›': 'èƒ½åŠ›',
  'è€å¹´äºº': 'è€å¹´äºº',
  'é¢„é˜²': 'é é˜²',
  'è¡°é€€': 'è¡°é€€',
  'ä¼˜åŒ–': 'å„ªåŒ–',
  'å¤§è„‘': 'å¤§è…¦',
  'å®ˆæŠ¤': 'å®ˆè­·',
  'å»¶ç¼“': 'å»¶ç·©',
  'å„¿ç«¥': 'å…’ç«¥',
  'ä¸“ä¸º': 'å°ˆç‚º',
  'å²': 'æ­²',
  'é’å°‘å¹´': 'é’å°‘å¹´',
  'è®¾è®¡': 'è¨­è¨ˆ',
  'æ¸¸æˆåŒ–': 'éŠæˆ²åŒ–',
  'è‡ªæ§åŠ›': 'è‡ªæ§åŠ›',
  'å·²æœåŠ¡': 'å·²æœå‹™',
  'å­¦æ ¡': 'å­¸æ ¡',
  'æ•°åä¸‡': 'æ•¸åè¬',
  'æˆç»©': 'æˆç¸¾',
  'æ¯ä¸ª': 'æ¯å€‹',
  'å­©å­': 'å­©å­',
  'éƒ½èƒ½': 'éƒ½èƒ½',
  'å·²': 'å·²',
  'æ™ºæ…§': 'æ™ºæ…§',
  'å¤§æ•°æ®': 'å¤§æ•¸æ“š',
  'è¯¾å ‚': 'èª²å ‚',
  'æ•™å¸ˆ': 'æ•™å¸«',
  'å»ºè®®': 'å»ºè­°',
  'è¦†ç›–': 'è¦†è“‹',
  'æ•™å®¤': 'æ•™å®¤',
  'å®ç°': 'å¯¦ç¾',
  'æ•°æ®é©±åŠ¨': 'æ•¸æ“šé©…å‹•',
  'ç²¾å‡†': 'ç²¾æº–',
  'æ•™å­¦': 'æ•™å­¸',
  'åˆ†æ': 'åˆ†æ',
  'é€‰æ‹©': 'é¸æ“‡',
  'æ›´ç§‘å­¦': 'æ›´ç§‘å­¸',
  'æ–°é—»': 'æ–°è',
  'èµ„è®¯': 'è³‡è¨Š',
  'è·å–': 'ç²å–',
  'äº§å“': 'ç”¢å“',
  'å‘å¸ƒ': 'ç™¼å¸ƒ',
  'å…³æ³¨': 'é—œæ³¨',
  'æ‹›è˜': 'æ‹›è˜',
  'åŠ å…¥': 'åŠ å…¥',
  'å¯»æ‰¾': 'å°‹æ‰¾',
  'å……æ»¡': 'å……æ»¿',
  'æ¿€æƒ…': 'æ¿€æƒ…',
  'äººæ‰': 'äººæ‰',
  'ç¡¬ä»¶': 'ç¡¬ä»¶',
  'å·¥ç¨‹': 'å·¥ç¨‹',
  'å¸‚åœº': 'å¸‚å ´',
  'è¥é”€': 'ç‡ŸéŠ·',
  'é¢†åŸŸ': 'é ˜åŸŸ',
  'èŒä½': 'è·ä½',
  'é¡¶å°–': 'é ‚å°–',
  'æœªæ¥': 'æœªä¾†',
  'å¹¿é˜”': 'å»£é—Š',
  'å¹³å°': 'å¹³å°',
  'æœŸå¾…': 'æœŸå¾…',
  'èŒä½åˆ—è¡¨': 'è·ä½åˆ—è¡¨',
  'æŸ¥çœ‹': 'æŸ¥çœ‹',
  'æµè§ˆ': 'ç€è¦½',
  'å¼€æ”¾': 'é–‹æ”¾',
  'åŒ…æ‹¬': 'åŒ…æ‹¬',
  'ç»ç†': 'ç¶“ç†',
  'ä¸“å‘˜': 'å°ˆå“¡',
  'æ‰¾åˆ°': 'æ‰¾åˆ°',
  'å²—ä½': 'å´—ä½',
  'æäº¤': 'æäº¤',
  'ç®€å†': 'ç°¡æ­·',
  'èŒä¸š': 'è·æ¥­',
  'æ‰€æœ‰': 'æ‰€æœ‰',
  'ç”³è¯·': 'ç”³è«‹',
};

/**
 * ç®€å•çš„ç®€ä½“è½¬ç¹ä½“
 */
function s2t(text) {
  if (!text) return text;
  let result = text;
  for (const [s, t] of Object.entries(s2tMap)) {
    result = result.replace(new RegExp(s, 'g'), t);
  }
  return result;
}

/**
 * ç”Ÿæˆç¹ä½“ä¸­æ–‡æ•°æ®ï¼ˆåŸºäºç®€ä½“ä¸­æ–‡ï¼‰
 */
function generateZhHant(zhHansData) {
  if (!zhHansData) return null;
  
  const zhHant = {};
  for (const [key, value] of Object.entries(zhHansData)) {
    if (typeof value === 'string') {
      zhHant[key] = s2t(value);
    } else if (Array.isArray(value)) {
      zhHant[key] = value.map(item => {
        if (typeof item === 'object') {
          return generateZhHant(item);
        }
        return typeof item === 'string' ? s2t(item) : item;
      });
    } else if (typeof value === 'object' && value !== null) {
      zhHant[key] = generateZhHant(value);
    } else {
      zhHant[key] = value;
    }
  }
  return zhHant;
}

/**
 * ä¸»å‡½æ•°
 */
function main() {
  console.log('ğŸš€ å¼€å§‹åˆå¹¶ SEO æ•°æ®å’Œ Schema æ•°æ®...\n');

  // è¯»å–ä¸¤ä¸ªæ–‡ä»¶
  const seoDataPath = path.join(__dirname, 'seo-data.json');
  const schemaDataPath = path.join(__dirname, 'schema-data-config.json');
  
  const seoData = JSON.parse(fs.readFileSync(seoDataPath, 'utf-8'));
  const schemaData = JSON.parse(fs.readFileSync(schemaDataPath, 'utf-8'));

  // åˆ›å»ºåˆå¹¶åçš„æ•°æ®ç»“æ„
  const mergedData = {
    pages: []
  };

  // ä»¥ SEO æ•°æ®ä¸ºåŸºç¡€ï¼Œåˆå¹¶ Schema æ•°æ®
  for (const seoPage of seoData.pages) {
    const { pageName, pagePath, locales } = seoPage;
    
    // æŸ¥æ‰¾å¯¹åº”çš„ Schema æ•°æ®
    const schemaPage = schemaData.pages.find(p => p.pagePath === pagePath);
    
    console.log(`ğŸ“„ å¤„ç†é¡µé¢: ${pagePath} (${pageName})`);
    
    const mergedPage = {
      pageName,
      pagePath,
      locales: {}
    };

    // å¤„ç†æ¯ç§è¯­è¨€
    for (const locale of ['zh-Hans', 'en', 'zh-Hant']) {
      const seoLocaleData = locales[locale];
      const schemaLocaleData = schemaPage?.schemas?.[locale];

      if (!seoLocaleData && !schemaLocaleData) {
        continue;
      }

      // å¦‚æœç¼ºå°‘ç¹ä½“ä¸­æ–‡ SEO æ•°æ®ï¼Œä»ç®€ä½“ä¸­æ–‡ç”Ÿæˆ
      let localeData = seoLocaleData;
      if (locale === 'zh-Hant' && !seoLocaleData && locales['zh-Hans']) {
        console.log(`   âš ï¸  ${locale}: ç¼ºå°‘ SEO æ•°æ®ï¼Œä»ç®€ä½“ä¸­æ–‡è‡ªåŠ¨ç”Ÿæˆ`);
        localeData = generateZhHant(locales['zh-Hans']);
      }

      // å¦‚æœç¼ºå°‘ç¹ä½“ä¸­æ–‡ Schema æ•°æ®ï¼Œä»ç®€ä½“ä¸­æ–‡ç”Ÿæˆ
      let schemaData = schemaLocaleData;
      if (locale === 'zh-Hant' && !schemaLocaleData && schemaPage?.schemas?.['zh-Hans']) {
        console.log(`   âš ï¸  ${locale}: ç¼ºå°‘ Schema æ•°æ®ï¼Œä»ç®€ä½“ä¸­æ–‡è‡ªåŠ¨ç”Ÿæˆ`);
        schemaData = generateZhHant(schemaPage.schemas['zh-Hans']);
      }

      if (localeData || schemaData) {
        mergedPage.locales[locale] = {
          ...(localeData || {}),
          ...(schemaData && { structuredData: schemaData })
        };
        console.log(`   âœ… ${locale}: æ•°æ®å·²åˆå¹¶`);
      }
    }

    mergedData.pages.push(mergedPage);
  }

  // å¤„ç†åªåœ¨ Schema æ•°æ®ä¸­å­˜åœ¨çš„é¡µé¢
  for (const schemaPage of schemaData.pages) {
    if (!seoData.pages.find(p => p.pagePath === schemaPage.pagePath)) {
      console.log(`âš ï¸  é¡µé¢ ${schemaPage.pagePath} åªæœ‰ Schema æ•°æ®ï¼Œæ²¡æœ‰ SEO æ•°æ®`);
      // å¯ä»¥é€‰æ‹©æ˜¯å¦åŒ…å«è¿™äº›é¡µé¢
    }
  }

  // å†™å…¥åˆå¹¶åçš„æ–‡ä»¶
  const outputPath = path.join(__dirname, 'seo-schema-data.json');
  fs.writeFileSync(outputPath, JSON.stringify(mergedData, null, 2), 'utf-8');

  console.log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log(`âœ… åˆå¹¶å®Œæˆï¼`);
  console.log(`   è¾“å‡ºæ–‡ä»¶: ${outputPath}`);
  console.log(`   é¡µé¢æ•°é‡: ${mergedData.pages.length}`);
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');
  
  console.log('ğŸ“ ä¸‹ä¸€æ­¥:');
  console.log('1. æ£€æŸ¥ç”Ÿæˆçš„ seo-schema-data.json æ–‡ä»¶');
  console.log('2. è¿è¡Œå¯¼å…¥è„šæœ¬: node scripts/import-seo-schema-data.js');
}

main();

